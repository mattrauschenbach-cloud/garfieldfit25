rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Public read-only collections (if any) can be whitelisted here.

    // Profiles: each user can read their own profile; mentors/admins can read all.
    match /profiles/{uid} {
      allow read: if request.auth != null
                  && (request.auth.uid == uid || get(/databases/$(database)/documents/profiles/$(request.auth.uid)).data.role in ['mentor','admin','owner']);
      allow write: if request.auth != null && request.auth.uid == uid;
    }

    // Monthly challenges (example structure)
    match /monthly/{monthId} {
      allow read: if request.auth != null;
      allow write: if request.auth != null && (get(/databases/$(database)/documents/profiles/$(request.auth.uid)).data.role in ['mentor','admin','owner']);
    }

    // Default: deny everything else
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
